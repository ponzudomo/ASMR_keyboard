# 視差効果 (Parallax Effect) 設計

## 1. コンセプト: 「触れる立体感」

この機能は、スマートフォンの傾きに応じてキーボードの背景やキーのレイヤーが独立して動くことで、画面の中に奥行きがあるような錯覚を生み出します。

### 🎯 ターゲットへの訴求
- **3DS世代の郷愁:** かつてニンテンドー3DSの立体視にときめいた世代に対し、デジタルな画面の中に「物質的な実在感」を感じさせる演出を提供します。
- **没入型の癒やし:** 視点が変わるたびに表情を変えるキーボードは、単なる入力ツールを超えた「眺めて楽しい」工芸品のような体験となります。

---

## 2. 視覚的メカニズム (Visual Mechanism)

`design/visual.md` で定義したレイヤー構造を活用し、各レイヤーに異なる「移動量（感度）」を設定します。

| レイヤー | 奥行き (想定) | 視差移動量 | 備考 |
| :--- | :--- | :--- | :--- |
| **L4: Effects** | 最前面 | 大 (正方向) | 指に近い位置で浮いているように演出 |
| **L3: Key Surface** | 前面 | 中 (正方向) | キーの表面 |
| **L2: Key Base** | 中面 | 0 | 基準面（動かさない、または微小） |
| **L1: Background** | 背面 | 小 (負方向) | 液体や木目が奥深くにあるように演出 |

### 擬似的な影 (Dynamic Shadows)
傾きに応じて影（Shadow）のオフセットを動的に変化させることで、光源が固定されているかのような、より高度な立体感を演出します。

---

## 3. 技術的実装案 (Technical Implementation)

### センサーの利用
- **Sensor:** `Gravity Sensor` または `Gyroscope` を使用。
- **Smoothing:** センサーの生データはノイズが多いため、ローパスフィルタ（Low-pass filter）を適用して滑らかな動きを実現します。

### Compose での描画
- **Modifier.graphicsLayer:** 各レイヤーのコンポーザブルに対して、センサーから得た傾き値を `translationX`, `translationY` に反映させます。
- **Offset Calculation:** 
  - $dx = \text{tiltX} \times \text{sensitivity}$
  - $dy = \text{tiltY} \times \text{sensitivity}$

---

## 4. ユーザー体験の配慮

- **省電力:** キーボードが表示されている間のみセンサーを稼働させ、非表示時は即座に停止します。
- **カスタマイズ:** 設定画面で視差効果の強さを調整、または完全にオフにできるようにします（3D酔い対策）。
